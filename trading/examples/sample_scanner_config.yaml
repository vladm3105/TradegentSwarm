# Example Scanner Configuration
# Scanner configs define systematic rules for finding trading opportunities

_meta:
  id: SCANNER-EXAMPLE-001
  type: scanner-config
  version: 1
  created: "2025-01-25T09:00:00Z"
  status: active
  run_frequency: daily

scanner_config:
  name: "High Volume Breakout Scanner"
  description: "Finds stocks breaking out of consolidation with unusual volume"
  category: momentum
  priority: 2

  schedule:
    run_at: "09:45"  # ET, 15 min after open
    run_days: [mon, tue, wed, thu, fri]

  limits:
    max_results: 20
    max_api_calls: 5
    timeout_seconds: 30

# Scanner Definition
scanner:
  source: ib  # IB scanner only (no web search)

  ib_scanner:
    scan_code: HOT_BY_VOLUME  # IB scanner code
    instrument: STK
    location: STK.US.MAJOR

    filters:
      above_price: 15
      below_price: 300
      above_volume: 500000
      above_avg_volume_pct: 200  # 2x average volume

# Quality Filters (applied after scan)
quality_filters:
  liquidity:
    min_avg_volume: 500000
    min_price: 15
    max_spread_pct: 0.5

  fundamentals:
    min_market_cap_millions: 1000
    exclude_adrs: true
    exclude_etfs: true

  exclusions:
    tickers: [SPY, QQQ, IWM]  # Index ETFs
    sectors: [Utilities]  # Low volatility

# Scoring Criteria (weights sum to 1.0)
scoring:
  criteria:
    - name: volume_surge
      weight: 0.30
      description: "Volume vs 20-day average"
      scoring:
        - range: [2, 3]
          score: 6
        - range: [3, 5]
          score: 8
        - range: [5, 999]
          score: 10

    - name: price_action
      weight: 0.25
      description: "Price change from prior close"
      scoring:
        - range: [2, 4]
          score: 6
        - range: [4, 7]
          score: 8
        - range: [7, 15]
          score: 10

    - name: technical_setup
      weight: 0.25
      description: "Breaking resistance or 52w high"
      scoring:
        near_resistance: 7
        new_52w_high: 10

    - name: relative_strength
      weight: 0.20
      description: "Outperforming SPY"
      scoring:
        - range: [0, 2]
          score: 5
        - range: [2, 5]
          score: 8
        - range: [5, 999]
          score: 10

# Output Configuration
output:
  format: yaml
  fields:
    - ticker
    - score
    - price
    - change_pct
    - volume_ratio
    - catalyst

  storage:
    path: "trading/knowledge/scanners/results/"
    filename_pattern: "{scanner_id}_{date}.yaml"

# Routing Rules
routing:
  score_thresholds:
    analyze: 7.5  # Score >= 7.5 triggers full analysis
    watchlist: 5.5  # Score 5.5-7.4 adds to watchlist
    skip: 0  # Score < 5.5 skipped

  auto_analyze:
    enabled: true
    analysis_type: stock
    max_per_run: 3

# Agent Instructions (for Claude Code)
agent_instructions: |
  1. Call IB scanner: mcp__ib-mcp__run_scanner with scan_code
  2. Apply quality_filters to results
  3. For each candidate:
     a. Get detailed quote: mcp__ib-mcp__get_stock_price
     b. Calculate scoring criteria
     c. Compute weighted score
  4. Sort by score descending
  5. Return top candidates as JSON:
     ```json
     {
       "scanner": "SCANNER-EXAMPLE-001",
       "run_time": "2025-01-25T09:45:00",
       "candidates": [
         {"ticker": "NVDA", "score": 8.5, "price": 142.50, ...},
         ...
       ]
     }
     ```
