# ═══════════════════════════════════════════════════════════════
# EARNINGS MOMENTUM SCANNER
# Identifies pre-earnings momentum setups 3-10 days before earnings
# Aligned with earnings-analysis skill v2.0
# ═══════════════════════════════════════════════════════════════

_meta:
  id: SCANNER-EARNINGS-MOMENTUM-001
  type: scanner-config
  version: 1
  created: "2025-01-25T09:00:00Z"
  updated: "2025-01-25T09:00:00Z"
  status: active
  run_frequency: daily
  last_run: null
  
scanner_config:
  name: "Earnings Momentum Scanner"
  description: "Finds stocks with upcoming earnings showing pre-earnings momentum"
  category: earnings
  priority: 2
  
  schedule:
    run_at: "09:45"  # ET, after market open settles
    run_days: [mon, tue, wed, thu, fri]
    skip_dates: []
    
  limits:
    max_results: 25
    max_api_calls: 15
    timeout_seconds: 45

# ═══════════════════════════════════════════════════════════════
# SCANNER DEFINITION
# ═══════════════════════════════════════════════════════════════

scanner:
  source: multi
  
  # Step 1: Get earnings calendar
  earnings_calendar:
    days_ahead_min: 3
    days_ahead_max: 10
    sources:
      - earnings_whispers
      - yahoo_finance
      - nasdaq_calendar
    
  # Step 2: IB data for each ticker
  ib_data:
    fields:
      - current_price
      - volume
      - avg_volume_10d
      - implied_volatility
      - 52w_high
      - 52w_low
      
  # Step 3: Web search for sentiment
  web_search:
    queries:
      - "{TICKER} earnings preview"
      - "{TICKER} analyst expectations"
      - "{TICKER} whisper number"
      - "{TICKER} earnings history"
    sources:
      - seekingalpha.com
      - earningswhispers.com
      - estimize.com
    recency: "7d"

# ═══════════════════════════════════════════════════════════════
# EARNINGS-SPECIFIC CRITERIA
# ═══════════════════════════════════════════════════════════════

earnings_criteria:
  # Beat history is crucial
  beat_history:
    min_beat_streak: 2
    prefer_streak_gte: 4
    weight_in_scoring: 0.20
    
  # Days to earnings sweet spot
  timing:
    optimal_entry_days: [5, 6, 7]  # 5-7 days before
    acceptable_range: [3, 10]
    
  # Pre-earnings momentum
  momentum_signals:
    - name: "Price vs 20D MA"
      bullish_if: "above"
      weight: 0.15
      
    - name: "10-day price change"
      bullish_if: "> 2%"
      weight: 0.10
      
    - name: "Relative strength vs sector"
      bullish_if: "outperforming"
      weight: 0.15
      
  # IV and options signals
  options_signals:
    iv_percentile_min: 40
    iv_percentile_max: 85  # Avoid extremely expensive IV
    expected_move_check: true
    
  # Historical earnings reactions
  historical_reactions:
    track_last_n_quarters: 8
    prefer_consistent_direction: true
    avg_move_threshold_pct: 5.0

# ═══════════════════════════════════════════════════════════════
# QUALITY FILTERS
# ═══════════════════════════════════════════════════════════════

quality_filters:
  liquidity:
    min_avg_volume: 1000000
    min_dollar_volume_m: 20
    min_options_volume: 1000
    max_spread_pct: 0.3
    
  fundamentals:
    exclude_sectors: [Utilities]  # Low volatility
    min_market_cap_m: 2000  # $2B+ for liquid options
    
  technicals:
    require_above_200d_ma: false  # Can trade both directions
    min_atr_pct: 1.5
    
  exclusions:
    exclude_tickers: []
    exclude_if_held: false
    exclude_recent_trades_days: 14

# ═══════════════════════════════════════════════════════════════
# SCORING CRITERIA (Aligned with Earnings Skill)
# ═══════════════════════════════════════════════════════════════

scoring:
  criteria:
    - name: beat_history_score
      weight: 0.20
      calculation: |
        10: 8/8 beats, strong beat magnitudes
        8: 6-7/8 beats
        6: 4-5/8 beats
        4: 2-3/8 beats
        2: <2/8 beats
        
    - name: momentum_score
      weight: 0.25
      calculation: |
        10: All momentum signals bullish, relative strength top decile
        7: Most signals bullish, RS positive
        5: Mixed signals
        3: Weak momentum
        1: Bearish momentum
        
    - name: sentiment_score
      weight: 0.20
      calculation: |
        10: Very bullish sentiment, whisper above consensus
        7: Bullish sentiment
        5: Neutral sentiment
        3: Cautious sentiment
        1: Bearish sentiment, lowered expectations
        
    - name: iv_setup_score
      weight: 0.15
      calculation: |
        10: IV 40-60 percentile, reasonable premium
        7: IV 60-75 percentile
        5: IV 30-40 or 75-85 percentile
        3: IV <30 (no vol) or >85 (expensive)
        
    - name: historical_reaction_score
      weight: 0.20
      calculation: |
        10: Consistent 8%+ moves, predictable direction
        7: 5-8% avg moves, mostly consistent
        5: 3-5% avg moves, mixed direction
        3: <3% avg moves
        1: Erratic, unpredictable reactions
        
  min_total_score: 6.5
  auto_analyze_threshold: 7.5  # Lower threshold - earnings need full analysis

# ═══════════════════════════════════════════════════════════════
# POSITIONING MATRIX
# ═══════════════════════════════════════════════════════════════

positioning_matrix:
  # From earnings-analysis skill
  scenarios:
    - conviction: "high"  # >70%
      price_action: "rising"
      position: "Full size, enter now"
      
    - conviction: "high"
      price_action: "flat"
      position: "Full size, enter now"
      
    - conviction: "high"
      price_action: "declining"
      position: "Wait for stabilization, reduced size"
      
    - conviction: "medium"  # 55-70%
      price_action: "rising"
      position: "Reduced size or spreads"
      
    - conviction: "medium"
      price_action: "flat"
      position: "Reduced size or spreads"
      
    - conviction: "medium"
      price_action: "declining"
      position: "Pass or small contrarian"
      
    - conviction: "low"  # <55%
      price_action: "any"
      position: "Pass - insufficient edge"

# ═══════════════════════════════════════════════════════════════
# OUTPUT FORMAT
# ═══════════════════════════════════════════════════════════════

output:
  format: watchlist
  
  capture_fields:
    - ticker
    - earnings_date
    - days_to_earnings
    - beat_streak
    - beat_history_8q
    - price
    - price_vs_20d_ma
    - relative_strength
    - iv_percentile
    - expected_move_pct
    - avg_historical_move_pct
    - sentiment_summary
    - whisper_vs_consensus
    - score
    - positioning_recommendation
    
  storage:
    watchlist_path: "watchlist/{YYYY}/{MM}/earnings/"
    log_path: "scanner-logs/{YYYY}/{MM}/earnings/"
    
  notifications:
    on_high_score: true
    on_earnings_within_5_days: true

# ═══════════════════════════════════════════════════════════════
# AI AGENT INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════

agent_instructions:
  execution_steps:
    1: "Get earnings calendar for next 3-10 days"
    2: "Filter by market cap > $2B and avg volume > 1M"
    3: "For each ticker, get IB data (price, volume, IV)"
    4: "Calculate beat history from last 8 quarters"
    5: "Calculate momentum signals (price vs MAs, RS)"
    6: "Search web for sentiment and whisper numbers"
    7: "Score each ticker using criteria"
    8: "Apply positioning matrix for recommendation"
    9: "Generate watchlist for score >= 6.5"
    10: "Auto-trigger full earnings analysis for score >= 7.5"
    
  customer_demand_check: |
    For high-conviction plays, verify customer demand signals:
    - Check customer CapEx announcements (50% weight per skill)
    - Cross-reference with supply chain data
    - This is the most important signal per earnings-analysis skill
    
  common_mistakes_to_avoid:
    - "Ignoring beat history - streaks matter"
    - "Entering with IV > 85th percentile (too expensive)"
    - "Not checking whisper vs consensus"
    - "Skipping the customer demand verification"
    - "Trading before checking positioning matrix"

_graph:
  entities:
    - [scanner, SCANNER-EARNINGS-MOMENTUM-001]
    - [category, earnings]
    - [skill, earnings-analysis]
  relations:
    - [this, scans_for, earnings-momentum]
    - [this, aligned_with, earnings-analysis-skill]

_links:
  skill_reference: "/mnt/skills/user/earnings-analysis/SKILL.md"
  output_template: "reference/templates/earnings-analysis.yaml"
