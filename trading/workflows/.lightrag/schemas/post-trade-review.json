{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "post-trade-review.json",
  "title": "Post-Trade Review",
  "description": "Structured post-trade analysis for learning loop",
  "type": "object",
  "required": ["_meta", "trade_reference", "outcome", "lessons", "grade"],
  "properties": {
    "_meta": {
      "type": "object",
      "required": ["id", "type", "version", "created", "status"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "const": "post-trade-review" },
        "version": { "type": "integer", "minimum": 1 },
        "created": { "type": "string" },
        "updated": { "type": "string" },
        "status": { "type": "string", "enum": ["draft", "completed", "archived"] }
      }
    },
    "trade_reference": {
      "type": "object",
      "required": ["ticker"],
      "properties": {
        "trade_id": { "type": "string" },
        "analysis_id": { "type": "string" },
        "ticker": { "type": "string" },
        "trade_type": { "type": "string" },
        "original_thesis": { "type": "object" },
        "dates": { "type": "object" }
      }
    },
    "execution_analysis": { "type": "object" },
    "outcome": {
      "type": "object",
      "properties": {
        "pnl": { "type": "object" },
        "result": { "type": "object" },
        "scenario_analysis": { "type": "object" }
      }
    },
    "thesis_accuracy": { "type": "object" },
    "analysis": { "type": "object" },
    "bias_retrospective": { "type": "object" },
    "skill_review": { "type": "object" },
    "lessons": {
      "type": "object",
      "properties": {
        "primary_lesson": { "type": "object" },
        "secondary_lessons": { "type": "array" },
        "pattern_updates": { "type": "array" },
        "rule_changes": { "type": "array" }
      }
    },
    "improvement_actions": { "type": "object" },
    "grade": {
      "type": "object",
      "properties": {
        "overall_grade": { "type": "string" },
        "component_grades": { "type": "object" },
        "grade_rationale": { "type": "string" }
      }
    },
    "summary": { "type": "object" },
    "_graph": { "type": "object" },
    "_links": { "type": "object" }
  }
}
