# ═══════════════════════════════════════════════════════════════
# OPTIONS FLOW SCANNER
# Tracks unusual options activity that often precedes big moves
# Smart money leaves footprints in the options market
# ═══════════════════════════════════════════════════════════════

_meta:
  id: SCANNER-OPTIONS-FLOW-001
  type: scanner-config
  version: 1
  created: "2025-01-25T09:00:00Z"
  updated: "2025-01-25T09:00:00Z"
  status: active
  run_frequency: intraday
  last_run: null
  
scanner_config:
  name: "Options Flow Scanner"
  description: "Identifies unusual options activity indicating smart money positioning"
  category: momentum
  priority: 2
  
  schedule:
    run_at: ["09:45", "11:00", "13:00", "15:00"]  # Multiple intraday runs
    run_days: [mon, tue, wed, thu, fri]
    skip_dates: []
    
  limits:
    max_results: 50
    max_api_calls: 20
    timeout_seconds: 45

# ═══════════════════════════════════════════════════════════════
# SCANNER DEFINITION
# ═══════════════════════════════════════════════════════════════

scanner:
  source: multi
  
  # IB Options data
  ib_options:
    data_types:
      - option_volume
      - open_interest
      - implied_volatility
      - greeks
      
  # Web search for flow data
  web_search:
    queries:
      - "unusual options activity today"
      - "large options block trade"
      - "options sweep order"
      - "dark pool options"
      - "whale options trade"
    sources:
      - unusualwhales.com
      - flowalgotrade.com
      - benzinga.com/options
      - barchart.com/options
    recency: "4h"

# ═══════════════════════════════════════════════════════════════
# FLOW CLASSIFICATION
# ═══════════════════════════════════════════════════════════════

flow_classification:
  # Types of unusual activity
  
  flow_types:
    - type: "Block Trade"
      description: "Single large trade, typically institutional"
      min_premium: 250000  # $250K+
      significance: high
      interpretation: |
        Large single prints often indicate institutional positioning.
        Check if at bid (bearish) or ask (bullish).
        
    - type: "Sweep Order"
      description: "Aggressive order sweeping multiple exchanges"
      min_premium: 100000  # $100K+
      significance: very_high
      interpretation: |
        Sweeps indicate urgency - buyer/seller wants in NOW.
        More predictive than blocks. Direction matters.
        
    - type: "Unusual Volume"
      description: "Volume significantly above open interest"
      threshold: "Volume > 2x OI"
      significance: medium
      interpretation: |
        New positions being opened. Check if calls or puts
        and whether at/above ask (bullish) or at/below bid (bearish).
        
    - type: "OI Surge"
      description: "Open interest increase >50% day over day"
      threshold: "OI change > 50%"
      significance: medium
      interpretation: |
        New money entering. Combine with volume analysis
        to determine if opening or closing positions.
        
    - type: "IV Spike"
      description: "Implied volatility surge without price move"
      threshold: "IV up >10% with price flat"
      significance: high
      interpretation: |
        Market makers pricing in expected move.
        Often precedes news or earnings adjustment.
        
    - type: "Put/Call Ratio Extreme"
      description: "Unusual put/call ratio"
      bullish_threshold: "<0.5"  # Low puts = bullish
      bearish_threshold: ">1.5"  # High puts = bearish
      significance: medium
      interpretation: |
        Extreme readings can be contrarian signals.
        Very high put/call at lows = potential bottom.

# ═══════════════════════════════════════════════════════════════
# FLOW ANALYSIS CRITERIA
# ═══════════════════════════════════════════════════════════════

flow_analysis:
  # Premium thresholds
  premium_tiers:
    - tier: "Whale"
      min_premium: 1000000  # $1M+
      weight: 1.0
      
    - tier: "Large"
      min_premium: 500000  # $500K+
      weight: 0.8
      
    - tier: "Notable"
      min_premium: 250000  # $250K+
      weight: 0.6
      
    - tier: "Standard"
      min_premium: 100000  # $100K+
      weight: 0.4
      
  # Direction indicators
  direction_signals:
    bullish:
      - "Calls bought at ask"
      - "Puts sold at bid"
      - "Call sweeps"
      - "Bull call spreads"
      - "Put selling (naked or cash-secured)"
      
    bearish:
      - "Puts bought at ask"
      - "Calls sold at bid"
      - "Put sweeps"
      - "Bear put spreads"
      - "Call selling"
      
    neutral:
      - "Straddles/strangles"
      - "Iron condors"
      - "Unclear direction"
      
  # Expiration analysis
  expiration_signals:
    near_term:
      days_to_expiry: "<14"
      interpretation: "Expecting imminent move"
      confidence_boost: 0.1
      
    standard:
      days_to_expiry: "14-45"
      interpretation: "Normal positioning"
      confidence_boost: 0.0
      
    leaps:
      days_to_expiry: ">180"
      interpretation: "Long-term conviction"
      confidence_boost: 0.15
      
  # Strike analysis
  strike_signals:
    deep_itm:
      delta: ">0.80"
      interpretation: "Stock replacement, high conviction"
      
    atm:
      delta: "0.40-0.60"
      interpretation: "Standard directional bet"
      
    otm:
      delta: "0.20-0.40"
      interpretation: "Leveraged bet, lower probability"
      
    deep_otm:
      delta: "<0.20"
      interpretation: "Lottery ticket or hedge"

# ═══════════════════════════════════════════════════════════════
# SMART MONEY INDICATORS
# ═══════════════════════════════════════════════════════════════

smart_money_indicators:
  # Signs of informed trading
  
  high_conviction_signals:
    - signal: "Multiple sweeps same direction"
      weight: 0.25
      description: "Repeated aggressive buying/selling"
      
    - signal: "Size at ask for calls (bid for puts)"
      weight: 0.20
      description: "Willing to pay up = conviction"
      
    - signal: "LEAPS with large premium"
      weight: 0.20
      description: "Long-term conviction with size"
      
    - signal: "Unusual activity before known catalyst"
      weight: 0.15
      description: "Positioning ahead of earnings/FDA/etc"
      
    - signal: "Repeat flow same ticker"
      weight: 0.10
      description: "Continued accumulation"
      
    - signal: "Dark pool correlation"
      weight: 0.10
      description: "Options + dark pool = institutional"
      
  # Warning signs (potentially misleading flow)
  warning_signs:
    - sign: "Flow against trend"
      description: "Could be hedging, not directional"
      
    - sign: "Spread trades misread as directional"
      description: "Check if part of multi-leg"
      
    - sign: "Closing transactions"
      description: "Existing position exit, not new bet"
      
    - sign: "Market maker activity"
      description: "Hedging, not directional view"
      
    - sign: "Very short-dated OTM"
      description: "Often lottery tickets, low success rate"

# ═══════════════════════════════════════════════════════════════
# QUALITY FILTERS
# ═══════════════════════════════════════════════════════════════

quality_filters:
  liquidity:
    min_stock_volume: 500000
    min_option_volume: 1000
    min_open_interest: 500
    max_spread_pct: 10  # Options spread
    
  premium:
    min_premium: 100000
    prefer_premium_above: 250000
    
  stock_filters:
    min_market_cap_m: 1000
    max_price: 500
    min_price: 10
    
  exclusions:
    exclude_tickers: [SPY, QQQ, IWM]  # Index ETFs have too much hedging
    exclude_earnings_within_days: 0  # Include earnings plays
    exclude_known_events: false

# ═══════════════════════════════════════════════════════════════
# SCORING CRITERIA
# ═══════════════════════════════════════════════════════════════

scoring:
  criteria:
    - name: flow_size
      weight: 0.25
      calculation: |
        10: Whale tier ($1M+)
        8: Large tier ($500K+)
        6: Notable tier ($250K+)
        4: Standard tier ($100K+)
        2: Below thresholds
        
    - name: flow_type
      weight: 0.25
      calculation: |
        10: Sweep orders (highest conviction)
        8: Block trades at ask/bid
        6: Unusual volume
        4: OI surge
        2: Mixed signals
        
    - name: direction_clarity
      weight: 0.20
      calculation: |
        10: Clear bullish/bearish, multiple confirmations
        7: Likely direction, some ambiguity
        5: Unclear direction
        3: Conflicting signals
        1: Appears to be hedging
        
    - name: timing_relevance
      weight: 0.15
      calculation: |
        10: Near-term expiry + known catalyst
        8: Standard expiry + catalyst
        6: Near-term, no obvious catalyst
        4: Long-dated
        2: Very long-dated (LEAPS) without news
        
    - name: repeat_flow
      weight: 0.15
      calculation: |
        10: Multiple large flows same direction today
        7: Follow-up to previous day's flow
        5: Single large flow
        3: Isolated activity
        1: Contradicts recent flow
        
  min_total_score: 6.0
  auto_analyze_threshold: 7.5

# ═══════════════════════════════════════════════════════════════
# TRADING STRATEGIES
# ═══════════════════════════════════════════════════════════════

strategies:
  follow_the_sweep:
    description: "Follow aggressive sweep orders"
    criteria:
      - "Sweep order $250K+"
      - "Clear direction (at ask for calls)"
      - "Score >= 7"
    entry: "Similar strike/expiry or stock"
    stop: "If flow reverses or stock breaks level"
    target: "Strike price or 50-100% option gain"
    notes: "Best within 1-2 hours of flow"
    
  accumulation_follow:
    description: "Follow repeated institutional accumulation"
    criteria:
      - "Multiple flows same direction over days"
      - "Total premium > $1M"
      - "Consistent strikes/expiries"
    entry: "On pullback in stock"
    stop: "Below support or flow reversal"
    target: "Based on strike prices targeted"
    notes: "Higher conviction, can size larger"
    
  earnings_flow:
    description: "Follow pre-earnings positioning"
    criteria:
      - "Large flow 1-5 days before earnings"
      - "Premium > $500K"
      - "Clear directional bias"
    entry: "Consider spread to reduce IV risk"
    stop: "Time-based or flow reversal"
    target: "Earnings reaction"
    notes: "Be aware of IV crush risk"

# ═══════════════════════════════════════════════════════════════
# OUTPUT FORMAT
# ═══════════════════════════════════════════════════════════════

output:
  format: watchlist
  
  capture_fields:
    - ticker
    - flow_type
    - direction
    - premium
    - contracts
    - strike
    - expiration
    - days_to_expiry
    - delta
    - execution_price  # At bid/ask/mid
    - underlying_price
    - time
    - source
    - repeat_flow
    - score
    - interpretation
    
  storage:
    watchlist_path: "watchlist/{YYYY}/{MM}/options-flow/"
    log_path: "scanner-logs/{YYYY}/{MM}/options-flow/"
    
  notifications:
    on_whale_trade: true  # $1M+
    on_sweep_order: true
    on_repeat_flow: true
    on_high_score: true

# ═══════════════════════════════════════════════════════════════
# AI AGENT INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════

agent_instructions:
  execution_steps:
    1: "Search web for unusual options activity in last 4 hours"
    2: "Filter by premium >= $100K"
    3: "Classify flow type (sweep, block, unusual volume)"
    4: "Determine direction (bullish/bearish/neutral)"
    5: "Check for repeat flow in same ticker"
    6: "Verify stock meets liquidity filters"
    7: "Score each flow"
    8: "Check for upcoming catalysts (earnings, FDA)"
    9: "Generate watchlist sorted by score"
    10: "Flag whale trades ($1M+) for immediate attention"
    
  interpretation_framework: |
    BULLISH SIGNALS:
    - Call sweeps at ask
    - Put selling at bid
    - Repeated call accumulation
    - ITM call buying (stock replacement)
    
    BEARISH SIGNALS:
    - Put sweeps at ask
    - Call selling at bid
    - Repeated put accumulation
    - Protective put buying with large premium
    
    CAUTION:
    - Single flow could be hedge
    - Check if spread trade
    - Verify not closing position
    - Index/ETF flow often hedging
    
  common_mistakes_to_avoid:
    - "Following every large trade (many are hedges)"
    - "Ignoring execution price (at bid vs ask matters)"
    - "Not checking for spread trades"
    - "Following flow in illiquid options"
    - "Chasing flow after stock has already moved"
    - "Ignoring the 'why' - upcoming earnings, FDA, etc."
    
  edge_cases:
    - "Straddle/strangle = expecting move, not direction"
    - "Very short-dated OTM = low probability, skip usually"
    - "LEAPS = long-term view, may take time to play out"
    - "Index options = often macro hedge, not stock-specific"

_graph:
  entities:
    - [scanner, SCANNER-OPTIONS-FLOW-001]
    - [category, momentum]
    - [signal, options-flow]
  relations:
    - [this, scans_for, unusual-options]
    - [this, identifies, smart-money]

_links:
  related_scanners:
    - "scanners/intraday/unusual-volume.yaml"
    - "scanners/daily/earnings-momentum.yaml"
  output_template: "reference/templates/watchlist.yaml"
